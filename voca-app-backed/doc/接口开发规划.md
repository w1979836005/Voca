# Voca 后端接口开发规划

## 项目架构

```
src/
├── app.js                  # 应用入口
├── config/
│   └── db.config.js       # 数据库配置
├── model/                  # 数据模型层
│   └── index.js           # 模型汇总
├── controller/             # 控制器层 (待创建)
├── service/                # 业务逻辑层 (待创建)
├── routes/                 # 路由层
│   ├── auth.js            # 认证路由 (待创建)
│   ├── user.js            # 用户路由 (待创建)
│   ├── wordlist.js        # 词单路由 (待创建)
│   └── learning.js        # 学习路由 (待创建)
├── middleware/             # 中间件
│   ├── errorHandler.js    # 全局异常处理
│   └── validation.js      # 参数验证
├── utils/                  # 工具类
│   └── ResponseUtil.js    # 响应工具
└── exceptions/             # 自定义异常
    └── CustomException.js # 异常类
```

## 接口开发优先级

### 第一阶段：基础认证 (优先级：🔴 高)
- 用户注册
- 用户登录
- 发送邮箱验证码
- 忘记密码
- Token 刷新

### 第二阶段：用户管理 (优先级：🟡 中)
- 获取用户信息
- 更新用户信息
- 修改密码
- 上传头像

### 第三阶段：词单管理 (优先级：🟡 中)
- 获取词单列表
- 获取词单详情
- 添加/移除用户词单
- 设置当前词单
- 词单搜索

### 第四阶段：学习功能 (优先级：🟢 低)
- 获取学习进度
- 获取学习单词
- 记录学习状态
- 获取学习统计

## 详细接口规划

### 1. 认证模块 (/api/auth)

#### 1.1 用户注册
- **URL**: `POST /api/auth/register`
- **参数**: username, email, password, code
- **返回**: userId, username, email, token
- **状态**: 待开发

#### 1.2 发送验证码
- **URL**: `POST /api/auth/send-code`
- **参数**: email
- **返回**: 发送成功
- **状态**: 待开发

#### 1.3 用户登录
- **URL**: `POST /api/auth/login`
- **参数**: email, password
- **返回**: userId, username, email, token
- **状态**: 待开发

#### 1.4 忘记密码
- **URL**: `POST /api/auth/forgot-password`
- **参数**: email, code, newPassword
- **返回**: 重置成功
- **状态**: 待开发

#### 1.5 刷新Token
- **URL**: `POST /api/auth/refresh`
- **参数**: refreshToken
- **返回**: newToken
- **状态**: 待开发

#### 1.6 退出登录
- **URL**: `POST /api/auth/logout`
- **参数**: 无
- **返回**: 退出成功
- **状态**: 待开发

### 2. 用户管理模块 (/api/user)

#### 2.1 获取用户信息
- **URL**: `GET /api/user/profile`
- **参数**: 无
- **返回**: 用户详细信息
- **状态**: 待开发

#### 2.2 更新用户信息
- **URL**: `PUT /api/user/profile`
- **参数**: username, userAvatar, userProfile, studyGoal
- **返回**: 更新后的用户信息
- **状态**: 待开发

#### 2.3 修改密码
- **URL**: `PUT /api/user/password`
- **参数**: oldPassword, newPassword
- **返回**: 修改成功
- **状态**: 待开发

#### 2.4 上传头像
- **URL**: `POST /api/user/avatar`
- **参数**: file (multipart/form-data)
- **返回**: 头像URL
- **状态**: 待开发

### 3. 词单管理模块 (/api/wordlist)

#### 3.1 获取词单列表
- **URL**: `GET /api/wordlist/list`
- **参数**: page, size, search, category
- **返回**: 分页的词单列表
- **状态**: 待开发

#### 3.2 获取词单详情
- **URL**: `GET /api/wordlist/:id`
- **参数**: id
- **返回**: 词单详细信息及单词列表
- **状态**: 待开发

#### 3.3 添加词单到我的列表
- **URL**: `POST /api/user/wordlist/:id`
- **参数**: id
- **返回**: 添加成功
- **状态**: 待开发

#### 3.4 从我的列表移除词单
- **URL**: `DELETE /api/user/wordlist/:id`
- **参数**: id
- **返回**: 移除成功
- **状态**: 待开发

#### 3.5 获取我的词单列表
- **URL**: `GET /api/user/wordlist`
- **参数**: page, size, search
- **返回**: 用户的词单列表
- **状态**: 待开发

#### 3.6 设置当前词单
- **URL**: `PUT /api/user/current-wordlist`
- **参数**: wordListId
- **返回**: 设置成功
- **状态**: 待开发

### 4. 学习模块 (/api/learning)

#### 4.1 获取今日学习进度
- **URL**: `GET /api/learning/progress`
- **参数**: 无
- **返回**: 今日学习进度数据
- **状态**: 待开发

#### 4.2 获取学习单词列表
- **URL**: `GET /api/learning/words`
- **参数**: type, wordListId, groupId, page, size
- **返回**: 学习单词列表
- **状态**: 待开发

#### 4.3 记录学习状态
- **URL**: `POST /api/learning/word/:id/progress`
- **参数**: status, correct, reviewTime
- **返回**: 记录成功
- **状态**: 待开发

#### 4.4 完成今日学习
- **URL**: `POST /api/learning/complete`
- **参数**: newWordsCount, reviewWordsCount, studyTime
- **返回**: 完成统计
- **状态**: 待开发

## 开发规范

### 1. 响应格式
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {},
  "timestamp": "2024-01-15T10:30:00Z"
}
```

### 2. 分页格式
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "list": [],
    "pagination": {
      "total": 100,
      "page": 1,
      "size": 10,
      "totalPages": 10,
      "hasNext": true,
      "hasPrev": false
    }
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
```

### 3. 错误处理
- 使用统一的全局异常处理中间件
- 自定义异常类型：ValidationException, AuthenticationException 等
- 开发环境返回详细错误信息，生产环境隐藏敏感信息

### 4. 参数验证
- 使用 Joi 进行参数验证
- 统一的验证中间件
- 详细的错误提示

### 5. 认证授权
- 使用 JWT 进行用户认证
- Token 有效期设置
- 刷新 Token 机制

## 需要的依赖包

```json
{
  "joi": "^18.0.1",           // 参数验证
  "jsonwebtoken": "^9.0.0",   // JWT 认证
  "bcryptjs": "^2.4.3",      // 密码加密
  "nodemailer": "^6.9.0",     // 邮件发送
  "multer": "^1.4.5"          // 文件上传
}
```

## 开发时间预估

- 第一阶段（认证模块）：2-3天
- 第二阶段（用户管理）：1-2天
- 第三阶段（词单管理）：2-3天
- 第四阶段（学习功能）：3-4天
- 测试和优化：2天

**总计：10-14天**

## 注意事项

1. **安全性**：
   - 密码加密存储
   - JWT Token 安全
   - SQL 注入防护
   - XSS 攻击防护

2. **性能优化**：
   - 数据库查询优化
   - 分页查询
   - 缓存机制
   - 接口响应时间监控

3. **日志记录**：
   - 请求日志
   - 错误日志
   - 业务操作日志
   - 性能监控日志

4. **测试**：
   - 单元测试
   - 集成测试
   - 接口测试
   - 压力测试